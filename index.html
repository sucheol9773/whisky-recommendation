<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🥃 나만의 위스키 찾기 - MBTI 스타일 위스키 추천</title>
    <meta name="description" content="MBTI처럼 간단한 질문으로 당신의 취향에 딱 맞는 위스키를 추천해드려요. 3분이면 완료!">
    <meta name="keywords" content="위스키, 추천, MBTI, 취향, 테스트, 위스키 추천, 스카치, 버번, 일본위스키">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="🥃 나만의 위스키 찾기">
    <meta property="og:description" content="MBTI처럼 간단한 질문으로 취향에 맞는 위스키를 추천받으세요!">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://whisky-recommendation.vercel.app/">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="🥃 나만의 위스키 찾기">
    <meta name="twitter:description" content="MBTI처럼 간단한 질문으로 취향에 맞는 위스키를 추천받으세요!">
    
    <meta name="theme-color" content="#f59e0b">
    
    <!-- Vercel Analytics -->
    <script defer src="https://analytics.vercel-insights.com/script.js"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Analytics 추적 함수
        const trackEvent = (eventName, properties = {}) => {
          if (typeof va !== 'undefined') {
            va('track', eventName, properties);
          }
        };

        // 간단한 아이콘 컴포넌트들
        const ChevronRight = () => <span>→</span>;
        const ChevronLeft = () => <span>←</span>;
        const RotateCcw = () => <span>↻</span>;
        const Star = () => <span>⭐</span>;
        const MapPin = () => <span>📍</span>;
        const Zap = () => <span>⚡</span>;
        const Grape = () => <span>🍇</span>;

        const WhiskyRecommendationApp = () => {
          const [currentScreen, setCurrentScreen] = useState('landing');
          const [currentStep, setCurrentStep] = useState(0);
          const [answers, setAnswers] = useState({});
          const [result, setResult] = useState(null);
          const [showDetailedResult, setShowDetailedResult] = useState(false);

          // 간단한 페이지 설정 (복잡한 복원 로직 제거)
          useEffect(() => {
            // 이제 간단한 스크린샷 방법만 사용하므로 복잡한 로직 불필요
          }, []);

          const startTest = () => {
            // 테스트 시작 추적
            trackEvent('Test Started');
            setCurrentScreen('test');
          };

          const resetTest = () => {
            // 테스트 리셋 추적
            trackEvent('Test Reset');
            setCurrentStep(0);
            setAnswers({});
            setResult(null);
            setCurrentScreen('landing');
          };

          // 질문 데이터
          const questions = [
            {
              id: 'experience',
              title: '위스키 경험이 어느 정도인가요?',
              type: 'single',
              options: [
                { value: 'beginner', label: '완전 초보자 (위스키를 거의 안 마셔봤어요)', icon: '🌱' },
                { value: 'casual', label: '가끔 마셔봤어요 (하이볼 정도)', icon: '🍹' },
                { value: 'interested', label: '관심이 생겨서 알아보는 중이에요', icon: '🤔' },
                { value: 'experienced', label: '어느 정도 경험이 있어요', icon: '🥃' }
              ]
            },
            {
              id: 'whisky_type_preference',
              title: '어떤 종류의 위스키에 관심이 있으신가요?',
              type: 'multiple',
              subtitle: '생산지/제조방식별 선호도 (여러 개 선택 가능)',
              options: [
                { value: 'scotch_single', label: '스카치 싱글몰트 (한 증류소만, 깊고 개성적인 맛)', icon: '🏴󠁧󠁢󠁳󠁣󠁴󠁿' },
                { value: 'scotch_blend', label: '스카치 블렌디드 (여러 위스키 조합, 균형잡힌 맛)', icon: '🥃' },
                { value: 'american_bourbon', label: '아메리칸 버번 (달콤하고 바닐라향 강한)', icon: '🇺🇸' },
                { value: 'japanese', label: '일본 위스키 (섬세하고 우아한, 꽃향과 균형미)', icon: '🇯🇵' },
                { value: 'irish', label: '아이리시 위스키 (부드럽고 순한, 초보자 친화적)', icon: '🇮🇪' },
                { value: 'any', label: '상관없어요 (다양하게 경험해보고 싶어요)', icon: '🌍' }
              ]
            },
            {
              id: 'flavor_intensity',
              title: '위스키의 맛 강도는 어느 정도를 선호하시나요?',
              type: 'single',
              options: [
                { value: 'mild', label: '부드럽고 순한 맛 (처음 마시기 편한)', icon: '🕊️' },
                { value: 'moderate', label: '적당한 강도 (특징은 있지만 부담스럽지 않은)', icon: '⚖️' },
                { value: 'bold', label: '진하고 강한 맛 (개성이 뚜렷한)', icon: '⚡' },
                { value: 'complex', label: '복합적이고 깊은 맛 (다층적인 풍미)', icon: '🌊' }
              ]
            },
            {
              id: 'sweetness_preference',
              title: '단맛에 대한 선호도는?',
              type: 'single',
              options: [
                { value: 'very_sweet', label: '달콤한 맛을 정말 좋아해요 (꿀, 캐러멜, 바닐라)', icon: '🍯' },
                { value: 'moderate_sweet', label: '적당한 단맛이 좋아요 (과일, 초콜릿)', icon: '🍫' },
                { value: 'dry_sweet', label: '은은한 단맛 정도 (건과일, 견과류)', icon: '🥜' },
                { value: 'no_sweet', label: '단맛보다는 드라이한 맛을 선호해요', icon: '🌿' }
              ]
            },
            {
              id: 'fruit_preference',
              title: '과일향 중에서는 어떤 계열을 선호하시나요?',
              type: 'multiple',
              subtitle: '과일향에 대한 구체적인 선호도',
              options: [
                { value: 'citrus', label: '시트러스 (레몬, 오렌지, 자몽)', icon: '🍊' },
                { value: 'stone_fruit', label: '핵과류 (복숭아, 살구, 자두)', icon: '🍑' },
                { value: 'apple_pear', label: '사과/배 (신선하고 아삭한)', icon: '🍎' },
                { value: 'berry', label: '베리류 (딸기, 블루베리, 라즈베리)', icon: '🫐' },
                { value: 'tropical', label: '열대과일 (파인애플, 망고, 바나나)', icon: '🍍' },
                { value: 'dried_fruit', label: '건과일 (건포도, 무화과, 대추)', icon: '🥭' },
                { value: 'no_fruit', label: '과일향은 별로 선호하지 않아요', icon: '❌' }
              ]
            },
            {
              id: 'smoke_preference',
              title: '스모키한 맛(피트향)에 대해 어떻게 생각하세요?',
              type: 'single',
              subtitle: '아일레이 위스키의 특징인 연기/흙내음',
              options: [
                { value: 'avoid', label: '피하고 싶어요 (연기 냄새는 부담스러워요)', icon: '🚫' },
                { value: 'curious', label: '궁금해요 (한 번 도전해보고 싶어요)', icon: '🤨' },
                { value: 'light_smoke', label: '가벼운 스모키는 괜찮아요', icon: '💨' },
                { value: 'like', label: '스모키한 맛을 좋아해요', icon: '😍' },
                { value: 'love_peat', label: '진한 피트향을 매우 좋아해요', icon: '🔥' }
              ]
            },
            {
              id: 'alcohol_tolerance',
              title: '알코올 도수에 대한 선호도는?',
              type: 'single',
              options: [
                { value: 'low', label: '부드럽고 낮은 도수를 선호 (40도 이하)', icon: '😌' },
                { value: 'medium', label: '적당한 도수가 좋아요 (40-43도)', icon: '👌' },
                { value: 'high', label: '진한 맛을 원해요 (43도 이상)', icon: '💪' },
                { value: 'cask_strength', label: '원액 그대로의 강한 맛도 괜찮아요', icon: '🔥' }
              ]
            },
            {
              id: 'drinking_style',
              title: '어떤 방식으로 마시고 싶으신가요?',
              type: 'multiple',
              options: [
                { value: 'neat', label: '스트레이트 (그대로)', icon: '🥃' },
                { value: 'rocks', label: '온더락 (얼음과 함께)', icon: '🧊' },
                { value: 'highball', label: '하이볼 (탄산수와 함께)', icon: '🥤' },
                { value: 'cocktail', label: '칵테일 베이스로', icon: '🍸' },
                { value: 'water', label: '물을 조금 넣어서', icon: '💧' }
              ]
            },
            {
              id: 'atmosphere',
              title: '어떤 분위기에서 마시고 싶으신가요?',
              type: 'single',
              options: [
                { value: 'casual', label: '집에서 편안하게', icon: '🏠' },
                { value: 'social', label: '친구들과 함께', icon: '👥' },
                { value: 'special', label: '특별한 날에', icon: '🎉' },
                { value: 'contemplative', label: '혼자서 여유롭게', icon: '🤔' }
              ]
            },
            {
              id: 'budget',
              title: '예산대는 어느 정도인가요?',
              type: 'single',
              options: [
                { value: 'budget', label: '5만원 이하 (입문용)', icon: '💰' },
                { value: 'mid', label: '5-10만원 (중급)', icon: '💳' },
                { value: 'premium', label: '10-20만원 (프리미엄)', icon: '💎' },
                { value: 'luxury', label: '20만원 이상 (럭셔리)', icon: '👑' }
              ]
            }
          ];

          // 위스키 데이터베이스
          const whiskies = [
            {
              name: '글렌피딕 12년',
              region: '스코틀랜드 (스페이사이드)',
              type: 'scotch_single',
              abv: 40,
              price: '입문용 (5만원대)',
              intensity: 'mild',
              sweetness: 'moderate_sweet',
              fruits: ['apple_pear', 'citrus'],
              smoke: 'avoid',
              drinking_styles: ['neat', 'rocks', 'water'],
              description: '부드럽고 달콤한 과일향이 특징인 초보자 친화적인 위스키',
              notes: '배, 사과, 꿀, 바닐라의 조화로운 맛',
              suitable_for: ['beginner', 'casual'],
              atmosphere: ['casual', 'social']
            },
            {
              name: '맥켈란 12년',
              region: '스코틀랜드 (스페이사이드)',
              type: 'scotch_single',
              abv: 40,
              price: '중급 (8만원대)',
              intensity: 'moderate',
              sweetness: 'very_sweet',
              fruits: ['dried_fruit', 'citrus'],
              smoke: 'avoid',
              drinking_styles: ['neat', 'rocks'],
              description: '셰리 캐스크 숙성으로 풍부한 단맛과 견과류 향이 특징',
              notes: '건포도, 초콜릿, 생강, 오렌지껍질',
              suitable_for: ['casual', 'interested', 'experienced'],
              atmosphere: ['special', 'contemplative']
            },
            {
              name: '라가불린 16년',
              region: '스코틀랜드 (아일레이)',
              type: 'scotch_single',
              abv: 43,
              price: '프리미엄 (15만원대)',
              intensity: 'complex',
              sweetness: 'dry_sweet',
              fruits: ['dried_fruit'],
              smoke: 'love_peat',
              drinking_styles: ['neat', 'rocks', 'water'],
              description: '강렬한 피트향과 복합적인 맛의 균형이 뛰어난 아일레이 위스키',
              notes: '바다향, 연기, 말린 과일, 후추',
              suitable_for: ['interested', 'experienced'],
              atmosphere: ['contemplative', 'special']
            },
            {
              name: '조니워커 블랙라벨',
              region: '스코틀랜드',
              type: 'scotch_blend',
              abv: 40,
              price: '중급 (7만원대)',
              intensity: 'moderate',
              sweetness: 'moderate_sweet',
              fruits: ['stone_fruit', 'citrus'],
              smoke: 'light_smoke',
              drinking_styles: ['neat', 'rocks', 'highball', 'cocktail'],
              description: '균형잡힌 블렌딩으로 다양한 방식으로 즐길 수 있는 위스키',
              notes: '과일, 바닐라, 스파이스, 가벼운 스모키',
              suitable_for: ['casual', 'interested'],
              atmosphere: ['casual', 'social', 'special']
            },
            {
              name: '히비키 하모니',
              region: '일본',
              type: 'japanese',
              abv: 43,
              price: '프리미엄 (12만원대)',
              intensity: 'moderate',
              sweetness: 'moderate_sweet',
              fruits: ['citrus', 'stone_fruit'],
              smoke: 'avoid',
              drinking_styles: ['neat', 'rocks', 'highball'],
              description: '섬세하고 우아한 일본 위스키의 대표작',
              notes: '꽃향, 꿀, 오렌지, 백단향',
              suitable_for: ['interested', 'experienced'],
              atmosphere: ['special', 'contemplative']
            },
            {
              name: '에반 윌리엄스 블랙',
              region: '미국 (켄터키)',
              type: 'american_bourbon',
              abv: 43,
              price: '입문용 (4만원대)',
              intensity: 'moderate',
              sweetness: 'very_sweet',
              fruits: ['no_fruit'],
              smoke: 'avoid',
              drinking_styles: ['neat', 'rocks', 'cocktail'],
              description: '솔직하고 전형적인 버번의 특성을 가진 가성비 위스키',
              notes: '바닐라, 캐러멜, 브라운슈가, 오크',
              suitable_for: ['beginner', 'casual', 'interested'],
              atmosphere: ['casual', 'social']
            }
          ];

          const handleAnswer = (questionId, value) => {
            const question = questions[currentStep];
            if (question.type === 'multiple') {
              const currentAnswers = answers[questionId] || [];
              const newAnswers = currentAnswers.includes(value)
                ? currentAnswers.filter(v => v !== value)
                : [...currentAnswers, value];
              setAnswers({ ...answers, [questionId]: newAnswers });
            } else {
              setAnswers({ ...answers, [questionId]: value });
            }
          };

          const nextStep = () => {
            // 질문 진행 추적
            trackEvent('Question Answered', {
              questionId: questions[currentStep].id,
              questionNumber: currentStep + 1,
              totalQuestions: questions.length
            });

            if (currentStep < questions.length - 1) {
              setCurrentStep(currentStep + 1);
            } else {
              calculateRecommendation();
            }
          };

          const prevStep = () => {
            // 이전 단계 추적
            trackEvent('Question Previous', {
              questionNumber: currentStep + 1
            });

            if (currentStep > 0) {
              setCurrentStep(currentStep - 1);
            }
          };

          const calculateRecommendation = () => {
            let scores = whiskies.map(whisky => ({ ...whisky, score: 0 }));

            // 경험도 점수
            if (answers.experience) {
              scores.forEach(whisky => {
                if (whisky.suitable_for.includes(answers.experience)) {
                  whisky.score += 25;
                }
              });
            }

            // 위스키 타입 선호도 점수
            if (answers.whisky_type_preference) {
              scores.forEach(whisky => {
                if (answers.whisky_type_preference.includes('any') || 
                    answers.whisky_type_preference.includes(whisky.type)) {
                  whisky.score += 20;
                }
              });
            }

            // 맛 강도 선호도 점수
            if (answers.flavor_intensity) {
              scores.forEach(whisky => {
                if (whisky.intensity === answers.flavor_intensity) {
                  whisky.score += 20;
                }
              });
            }

            // 단맛 선호도 점수
            if (answers.sweetness_preference) {
              scores.forEach(whisky => {
                if (whisky.sweetness === answers.sweetness_preference) {
                  whisky.score += 20;
                }
              });
            }

            // 과일향 선호도 점수
            if (answers.fruit_preference) {
              scores.forEach(whisky => {
                if (answers.fruit_preference.includes('no_fruit')) {
                  if (whisky.fruits.includes('no_fruit')) {
                    whisky.score += 15;
                  }
                } else {
                  const matchingFruits = whisky.fruits.filter(fruit => 
                    answers.fruit_preference.includes(fruit)
                  ).length;
                  whisky.score += matchingFruits * 10;
                }
              });
            }

            // 스모키 선호도 점수
            if (answers.smoke_preference) {
              scores.forEach(whisky => {
                if (whisky.smoke === answers.smoke_preference) {
                  whisky.score += 25;
                }
                if (answers.smoke_preference === 'curious' && whisky.smoke === 'light_smoke') {
                  whisky.score += 15;
                }
              });
            }

            // 도수 선호도 점수
            if (answers.alcohol_tolerance) {
              scores.forEach(whisky => {
                if (answers.alcohol_tolerance === 'low' && whisky.abv <= 40) whisky.score += 15;
                if (answers.alcohol_tolerance === 'medium' && whisky.abv >= 40 && whisky.abv <= 43) whisky.score += 15;
                if (answers.alcohol_tolerance === 'high' && whisky.abv > 43) whisky.score += 15;
              });
            }

            // 마시는 방식 점수
            if (answers.drinking_style) {
              scores.forEach(whisky => {
                const matchingStyles = whisky.drinking_styles.filter(style => 
                  answers.drinking_style.includes(style)
                ).length;
                whisky.score += matchingStyles * 10;
              });
            }

            // 분위기 점수
            if (answers.atmosphere) {
              scores.forEach(whisky => {
                if (whisky.atmosphere.includes(answers.atmosphere)) {
                  whisky.score += 15;
                }
              });
            }

            // 예산 점수
            if (answers.budget) {
              scores.forEach(whisky => {
                if (answers.budget === 'budget' && whisky.price.includes('입문용')) whisky.score += 20;
                if (answers.budget === 'mid' && (whisky.price.includes('중급') || whisky.price.includes('입문용'))) whisky.score += 20;
                if (answers.budget === 'premium' && whisky.price.includes('프리미엄')) whisky.score += 20;
              });
            }

            // 점수순으로 정렬하여 상위 3개 추천
            const recommendations = scores
              .sort((a, b) => b.score - a.score)
              .slice(0, 3);

            // 매칭도 계산
            if (recommendations.length > 0) {
              const maxPossibleScore = 180;
              recommendations.forEach(whisky => {
                const rawPercentage = (whisky.score / maxPossibleScore) * 100;
                whisky.matchPercentage = Math.min(98, Math.max(65, Math.round(rawPercentage)));
              });
            }

            // 테스트 완료 추적
            trackEvent('Test Completed', {
              topWhisky: recommendations[0].name,
              matchPercentage: recommendations[0].matchPercentage,
              region: recommendations[0].region,
              totalAnswers: Object.keys(answers).length
            });

            setResult(recommendations);
            setCurrentScreen('result');
          };

          const shareResult = () => {
            const topWhisky = result[0];
            const shareText = `🥃 나만의 위스키 찾기 결과!\n\n추천 위스키: ${topWhisky.name}\n매칭도: ${topWhisky.matchPercentage}%\n\n${topWhisky.description}\n\n당신의 취향은? 테스트해보세요!`;
            const shareUrl = window.location.href;

            if (navigator.share) {
              navigator.share({
                title: '🥃 나만의 위스키 찾기 결과',
                text: shareText,
                url: shareUrl
              }).catch(console.error);
            } else {
              const fullText = `${shareText}\n\n${shareUrl}`;
              navigator.clipboard.writeText(fullText).then(() => {
                alert('🎉 공유 텍스트가 클립보드에 복사되었습니다!\nSNS에 붙여넣기 해주세요.');
              }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = fullText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('🎉 공유 텍스트가 복사되었습니다!\nSNS에 붙여넣기 해주세요.');
              });
            }
          };

          const generateResultImage = () => {
            const canvas = document.createElement('canvas');
            canvas.width = 1080;
            canvas.height = 1920; // 9:16 비율
            const ctx = canvas.getContext('2d');
            
            const topWhisky = result[0];
            
            // 배경 그라데이션 (amber-400 → orange-500 → red-500)
            const gradient = ctx.createLinearGradient(0, 0, 1080, 1920);
            gradient.addColorStop(0, '#FBBF24'); // amber-400
            gradient.addColorStop(0.5, '#F97316'); // orange-500  
            gradient.addColorStop(1, '#EF4444'); // red-500
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 1080, 1920);
            
            // 배경 장식 이모지들 (반투명) - 위치 조정
            ctx.globalAlpha = 0.15;
            ctx.font = '120px Arial';
            ctx.fillStyle = '#FFFFFF';
            ctx.textAlign = 'center';
            
            // 위스키 🥃
            ctx.fillText('🥃', 200, 200);
            // 별 ✨  
            ctx.fillText('✨', 880, 350);
            // 불 🔥 - 아래로 이동
            ctx.fillText('🔥', 200, 1650);
            // 별 ⭐ - 아래로 이동
            ctx.fillText('⭐', 880, 1800);
            
            ctx.globalAlpha = 1.0;
            
            // 헤더 영역
            ctx.fillStyle = '#FFFFFF';
            ctx.textAlign = 'center';
            ctx.font = '120px Arial';
            ctx.fillText('🥃', 540, 280);
            
            ctx.font = 'bold 50px Arial, sans-serif';
            ctx.fillText('나만의 위스키 찾기', 540, 360);
            
            ctx.font = '36px Arial, sans-serif';
            ctx.globalAlpha = 0.9;
            ctx.fillText('MBTI 스타일 취향 분석 완료!', 540, 420);
            ctx.globalAlpha = 1.0;
            
            // 중앙 카드 (반투명 흰색) - 크기 확장
            ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
            ctx.shadowColor = 'rgba(0, 0, 0, 0.2)';
            ctx.shadowBlur = 30;
            ctx.shadowOffsetY = 10;
            
            // roundRect 구현 (Canvas 호환성)
            const drawRoundRect = (x, y, width, height, radius) => {
              ctx.beginPath();
              ctx.moveTo(x + radius, y);
              ctx.lineTo(x + width - radius, y);
              ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
              ctx.lineTo(x + width, y + height - radius);
              ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
              ctx.lineTo(x + radius, y + height);
              ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
              ctx.lineTo(x, y + radius);
              ctx.quadraticCurveTo(x, y, x + radius, y);
              ctx.closePath();
            };
            
            // 카드 크기 확장: y:480에서 높이 880
            drawRoundRect(90, 480, 900, 880, 50);
            ctx.fill();
            
            ctx.shadowColor = 'transparent';
            
            // 트로피 이모지 - 상단 여백 확장
            ctx.font = '80px Arial';
            ctx.fillStyle = '#FBBF24';
            ctx.fillText('🏆', 540, 620);
            
            // "당신의 위스키는" 텍스트 - 간격 조정
            ctx.font = 'bold 40px Arial, sans-serif';
            ctx.fillStyle = '#374151';
            ctx.fillText('당신의 위스키는', 540, 700);
            
            // 위스키 이름 - 간격 조정
            ctx.font = 'bold 60px Arial, sans-serif';
            ctx.fillStyle = '#D97706';
            ctx.fillText(topWhisky.name, 540, 780);
            
            // 원형 매칭도 게이지 - 위치 조정
            const centerX = 540;
            const centerY = 920; // 카드 정가운데
            const radius = 72;   // 기존보다 20% 확대
            
            // 외부 원 (그라데이션)
            const gaugeGradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);
            gaugeGradient.addColorStop(0, '#FBBF24');
            gaugeGradient.addColorStop(1, '#F97316');
            ctx.fillStyle = gaugeGradient;
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx.fill();
            
            // 내부 원 (흰색)
            ctx.fillStyle = '#FFFFFF';
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius - 10, 0, 2 * Math.PI);
            ctx.fill();
            
            // 매칭도 텍스트
            ctx.font = 'bold 32px Arial, sans-serif';
            ctx.fillStyle = '#D97706';
            ctx.fillText(`${topWhisky.matchPercentage}%`, centerX, centerY + 10);
            
            // 위스키 정보들 - 위치와 간격 조정
            const infoY = 970;
            const infoSpacing = 70;
            
            ctx.font = 'bold 32px Arial, sans-serif';
            ctx.fillStyle = '#374151';
            
            // 지역
            ctx.fillText(`📍 ${topWhisky.region}`, 540, infoY);
            
            // 도수
            ctx.fillText(`⚡ 도수 ${topWhisky.abv}%`, 540, infoY + infoSpacing);
            
            // 가격
            ctx.fillText(`💰 ${topWhisky.price}`, 540, infoY + infoSpacing * 2);
            
            // 설명 박스 - 하단 여백 50px 줄여 카드와 간격 50 유지
            ctx.fillStyle = 'rgba(251, 191, 36, 0.1)';
            drawRoundRect(120, 1230, 840, 80, 25);
            ctx.fill();
            
            // 설명 텍스트 - 박스 세로 중앙 배치 (한 줄, 길면 줄바꿈 후 중앙정렬)
            ctx.font = '24px Arial, sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillStyle = '#374151';

            const boxTop = 1230;
            const boxHeight = 80;
            const boxCenterY = boxTop + boxHeight / 2;
            const boxPaddingX = 40; // 좌우 여백
            const maxLineWidth = 840 - boxPaddingX * 2;

            const words = topWhisky.description.split(' ');
            const lines = [];
            let currentLine = '';

            words.forEach(word => {
              const testLine = currentLine ? currentLine + ' ' + word : word;
              if (ctx.measureText(testLine).width > maxLineWidth) {
                if (currentLine) lines.push(currentLine);
                currentLine = word;
              } else {
                currentLine = testLine;
              }
            });
            if (currentLine) lines.push(currentLine);

            const lineHeight = 30; // 줄 높이
            const totalTextHeight = lineHeight * lines.length;
            let startY = boxCenterY - totalTextHeight / 2 + lineHeight / 2;

            lines.forEach(line => {
              ctx.fillText(line, 540, startY);
              startY += lineHeight;
            });
            
            // 하단 CTA 영역 - 위치 조정하여 공백 줄이기
            ctx.fillStyle = '#FFFFFF';
            ctx.font = 'bold 36px Arial, sans-serif';
            ctx.fillText('🎯 나도 테스트해보기', 540, 1450);
            
            ctx.font = '28px Arial, sans-serif';
            ctx.globalAlpha = 0.9;
            ctx.fillText('whisky-recommendation.vercel.app', 540, 1500);
            ctx.globalAlpha = 1.0;
            
            return canvas;
          };

          const shareToInstagram = () => {
            // 공유 클릭 추적
            trackEvent('Instagram Share Click', {
              topWhisky: result[0].name,
              matchPercentage: result[0].matchPercentage
            });

            const serviceUrl = window.location.href;
            
            // 인스타그램 앱 내 브라우저 감지
            const isInstagramBrowser = navigator.userAgent.includes('Instagram') || 
                                     window.location.href.includes('instagram.com') ||
                                     document.referrer.includes('instagram.com');
            
            if (isInstagramBrowser) {
              // 인스타그램 브라우저 - 초간단 스크린샷 방법
              trackEvent('Instagram Browser - Screenshot Method');
              
              // 링크 복사
              navigator.clipboard.writeText(serviceUrl).then(() => {
                trackEvent('Service URL Copied');
                alert(`📱 인스타그램에서 접속하셨네요!

🎯 가장 간단한 공유 방법:

1️⃣ 📸 이 화면을 **스크린샷** 찍기
2️⃣ 📱 인스타그램 스토리 작성하기  
3️⃣ 📷 갤러리에서 방금 찍은 스크린샷 선택
4️⃣ 🔗 링크 스티커 추가 → 자동 복사된 링크 붙여넣기
5️⃣ 📤 스토리 게시!

✅ 서비스 링크가 자동으로 복사되었습니다!
이제 스크린샷을 찍어주세요 📸`);
              }).catch(() => {
                // 클립보드 실패 시 대체 방법
                try {
                  const textArea = document.createElement('textarea');
                  textArea.value = serviceUrl;
                  textArea.style.position = 'fixed';
                  textArea.style.left = '-9999px';
                  document.body.appendChild(textArea);
                  textArea.select();
                  textArea.setSelectionRange(0, 99999);
                  document.execCommand('copy');
                  document.body.removeChild(textArea);
                  
                  alert(`📱 인스타그램에서 접속하셨네요!

🎯 가장 간단한 공유 방법:

1️⃣ 📸 이 화면을 **스크린샷** 찍기
2️⃣ 📱 인스타그램 스토리 작성하기  
3️⃣ 📷 갤러리에서 방금 찍은 스크린샷 선택
4️⃣ 🔗 링크 스티커 추가 → 아래 링크 복사해서 붙여넣기
5️⃣ 📤 스토리 게시!

🔗 복사할 링크: ${serviceUrl}

이제 스크린샷을 찍어주세요 📸`);
                } catch (copyError) {
                  alert(`📱 인스타그램에서 접속하셨네요!

🎯 가장 간단한 공유 방법:

1️⃣ 📸 이 화면을 **스크린샷** 찍기
2️⃣ 📱 인스타그램 스토리 작성하기  
3️⃣ 📷 갤러리에서 방금 찍은 스크린샷 선택
4️⃣ 🔗 링크 스티커 추가 → 아래 링크 복사해서 붙여넣기
5️⃣ 📤 스토리 게시!

🔗 복사할 링크: ${serviceUrl}

이제 스크린샷을 찍어주세요 📸`);
                }
              });
              
            } else {
              // 일반 브라우저 - 방법 선택 옵션 제공
              const userChoice = confirm(`📸 공유 방법을 선택해주세요:

✅ "확인" → 자동 이미지 다운로드 + 링크 복사
❌ "취소" → 스크린샷 방법 (더 간단함)`);
              
              if (userChoice) {
                // 자동 다운로드 방식
                try {
                  const canvas = generateResultImage();
                  const dataURL = canvas.toDataURL('image/png');
                  const topWhisky = result[0];
                  
                  const link = document.createElement('a');
                  link.download = `위스키추천_${topWhisky.name.replace(/\s+/g, '_')}.png`;
                  link.href = dataURL;
                  
                  document.body.appendChild(link);
                  link.click();
                  document.body.removeChild(link);

                  trackEvent('Result Image Downloaded', {
                    whiskyName: topWhisky.name
                  });

                  // 링크 복사
                  navigator.clipboard.writeText(serviceUrl).then(() => {
                    trackEvent('Service URL Copied');
                    alert(`✅ 모든 준비 완료!

📷 이미지가 자동으로 다운로드되었습니다
🔗 링크가 자동으로 복사되었습니다

📱 인스타그램 스토리에서:
1. 📷 갤러리에서 다운로드된 이미지 선택
2. 🔗 링크 스티커 추가 → 복사된 링크 붙여넣기
3. 📤 스토리 게시!

인스타그램이 자동으로 열립니다...`);
                    
                    setTimeout(() => {
                      if (/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                        window.location.href = 'instagram://story-camera';
                      } else {
                        window.open('https://www.instagram.com/stories/create/', '_blank');
                      }
                    }, 2000);
                  }).catch(() => {
                    alert(`📷 이미지가 다운로드되었습니다!

🔗 링크를 수동으로 복사해주세요: ${serviceUrl}

📱 인스타그램 스토리에서 링크 스티커에 붙여넣어주세요!`);
                  });
                } catch (error) {
                  console.error('Image generation error:', error);
                  alert('이미지 생성 중 오류가 발생했습니다. 스크린샷 방법을 시도해보세요!');
                }
              } else {
                // 스크린샷 방법
                trackEvent('Screenshot Method Selected');
                navigator.clipboard.writeText(serviceUrl).then(() => {
                  trackEvent('Service URL Copied');
                  alert(`📸 스크린샷 방법 (추천!)

🎯 가장 간단하고 확실한 방법:

1️⃣ 📸 이 화면을 **스크린샷** 찍기
2️⃣ 📱 인스타그램 스토리 작성하기  
3️⃣ 📷 갤러리에서 방금 찍은 스크린샷 선택
4️⃣ 🔗 링크 스티커 추가 → 자동 복사된 링크 붙여넣기
5️⃣ 📤 스토리 게시!

✅ 서비스 링크가 자동으로 복사되었습니다!
이제 스크린샷을 찍어주세요 📸`);
                }).catch(() => {
                  alert(`📸 스크린샷 방법 (추천!)

🎯 가장 간단하고 확실한 방법:

1️⃣ 📸 이 화면을 **스크린샷** 찍기
2️⃣ 📱 인스타그램 스토리 작성하기  
3️⃣ 📷 갤러리에서 방금 찍은 스크린샷 선택
4️⃣ 🔗 링크 스티커 추가 → 아래 링크 복사해서 붙여넣기
5️⃣ 📤 스토리 게시!

🔗 복사할 링크: ${serviceUrl}

이제 스크린샷을 찍어주세요 📸`);
                });
              }
            }
          };

          // 랜딩 페이지
          if (currentScreen === 'landing') {
            return (
              <div className="max-w-2xl mx-auto p-4 bg-gradient-to-br from-amber-50 to-orange-50 min-h-screen flex items-center">
                <div className="bg-white rounded-2xl shadow-2xl p-6 w-full">
                  <div className="text-center mb-8">
                    <div className="text-5xl mb-3">🥃</div>
                    <h1 className="text-3xl font-bold text-amber-800 mb-3">
                      나만의 위스키 찾기
                    </h1>
                    <p className="text-gray-600 mb-4">
                      MBTI처럼 간단한 질문으로<br/>
                      취향에 딱 맞는 위스키를 추천해드려요
                    </p>
                  </div>

                  <div className="grid grid-cols-3 gap-3 mb-8">
                    <div className="text-center p-3 bg-amber-50 rounded-lg">
                      <div className="text-2xl mb-1">🎯</div>
                      <p className="text-xs font-medium text-amber-800">정확한<br/>추천</p>
                    </div>
                    <div className="text-center p-3 bg-orange-50 rounded-lg">
                      <div className="text-2xl mb-1">⚡</div>
                      <p className="text-xs font-medium text-orange-800">3분<br/>완료</p>
                    </div>
                    <div className="text-center p-3 bg-yellow-50 rounded-lg">
                      <div className="text-2xl mb-1">🏆</div>
                      <p className="text-xs font-medium text-yellow-800">전문<br/>큐레이션</p>
                    </div>
                  </div>

                  <div className="mb-8 p-4 bg-gradient-to-r from-amber-100 to-orange-100 rounded-xl">
                    <h3 className="text-center font-bold text-amber-800 mb-3">
                      📊 이런 식으로 추천해요!
                    </h3>
                    <div className="bg-white p-3 rounded-lg">
                      <div className="flex items-center gap-2 mb-2">
                        <div className="bg-amber-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">1</div>
                        <span className="font-bold text-amber-900 text-sm">글렌피딕 12년</span>
                        <span className="bg-amber-200 px-2 py-1 rounded-full text-xs text-amber-800 font-medium ml-auto">95%</span>
                      </div>
                      <div className="flex gap-1 mb-2">
                        <span className="bg-green-100 px-2 py-1 rounded-full text-xs text-green-700">✨ 논스모키</span>
                        <span className="bg-blue-50 px-2 py-1 rounded-full text-xs text-blue-700">🍎 과일향</span>
                      </div>
                      <p className="text-xs text-gray-600">부드럽고 달콤한 초보자 친화적인 위스키</p>
                    </div>
                  </div>

                  <div className="text-center">
                    <button
                      onClick={startTest}
                      className="w-full bg-gradient-to-r from-amber-500 to-orange-500 text-white py-4 rounded-2xl text-lg font-bold hover:from-amber-600 hover:to-orange-600 transition-all duration-300 shadow-lg"
                    >
                      🚀 테스트 시작하기
                    </button>
                    <p className="text-xs text-gray-500 mt-3">
                      3분 소요 • 무료 • 회원가입 불필요
                    </p>
                  </div>
                </div>
              </div>
            );
          }

          // 질문 화면
          if (currentScreen === 'test') {
            const currentQuestion = questions[currentStep];
            const canProceed = answers[currentQuestion?.id] && 
              (currentQuestion?.type !== 'multiple' || answers[currentQuestion?.id].length > 0);

            return (
              <div className="max-w-2xl mx-auto p-6 bg-gradient-to-br from-amber-50 to-orange-50 min-h-screen">
                <div className="bg-white rounded-2xl shadow-2xl p-8">
                  <div className="text-center mb-8">
                    <h1 className="text-3xl font-bold text-amber-800 mb-2">🥃 나만의 위스키 찾기</h1>
                    <p className="text-gray-600">MBTI처럼 간단한 질문으로 취향에 맞는 위스키를 추천해드려요</p>
                  </div>

                  <div className="mb-8">
                    <div className="flex justify-between text-sm text-gray-500 mb-2">
                      <span>진행도</span>
                      <span>{currentStep + 1} / {questions.length}</span>
                    </div>
                    <div className="w-full bg-gray-200 rounded-full h-2">
                      <div 
                        className="bg-gradient-to-r from-amber-400 to-orange-500 h-2 rounded-full transition-all duration-500"
                        style={{ width: `${((currentStep + 1) / questions.length) * 100}%` }}
                      />
                    </div>
                  </div>

                  <div className="mb-8">
                    <h2 className="text-xl font-bold text-gray-800 mb-2">{currentQuestion.title}</h2>
                    {currentQuestion.subtitle && (
                      <p className="text-sm text-gray-600 mb-4">{currentQuestion.subtitle}</p>
                    )}

                    <div className="space-y-3">
                      {currentQuestion.options.map((option) => {
                        const isSelected = currentQuestion.type === 'multiple' 
                          ? (answers[currentQuestion.id] || []).includes(option.value)
                          : answers[currentQuestion.id] === option.value;

                        return (
                          <button
                            key={option.value}
                            onClick={() => handleAnswer(currentQuestion.id, option.value)}
                            className={`w-full p-4 rounded-xl border-2 text-left transition-all duration-200 ${
                              isSelected
                                ? 'border-amber-500 bg-amber-50 text-amber-900'
                                : 'border-gray-200 hover:border-amber-300 hover:bg-amber-25'
                            }`}
                          >
                            <div className="flex items-center gap-3">
                              <span className="text-2xl">{option.icon}</span>
                              <span className="font-medium">{option.label}</span>
                            </div>
                          </button>
                        );
                      })}
                    </div>
                  </div>

                  <div className="flex justify-between">
                    <button
                      onClick={prevStep}
                      disabled={currentStep === 0}
                      className={`inline-flex items-center gap-2 px-6 py-3 rounded-xl transition-colors ${
                        currentStep === 0
                          ? 'bg-gray-100 text-gray-400 cursor-not-allowed'
                          : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                      }`}
                    >
                      <ChevronLeft />
                      이전
                    </button>

                    <button
                      onClick={nextStep}
                      disabled={!canProceed}
                      className={`inline-flex items-center gap-2 px-6 py-3 rounded-xl transition-colors font-medium ${
                        canProceed
                          ? 'bg-amber-600 text-white hover:bg-amber-700'
                          : 'bg-gray-100 text-gray-400 cursor-not-allowed'
                      }`}
                    >
                      {currentStep === questions.length - 1 ? '결과 보기' : '다음'}
                      <ChevronRight />
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          // 결과 화면
          if (result) {
            const topWhisky = result[0];
            
            if (!showDetailedResult) {
              // 스크린샷 최적화 화면
              return (
                <div className="w-full min-h-screen bg-gradient-to-br from-amber-400 via-orange-500 to-red-500 relative overflow-hidden">
                  {/* 배경 패턴 */}
                  <div className="absolute inset-0 opacity-10">
                    <div className="absolute top-10 left-10 text-6xl">🥃</div>
                    <div className="absolute top-32 right-8 text-4xl">✨</div>
                    <div className="absolute bottom-40 left-8 text-5xl">🔥</div>
                    <div className="absolute bottom-20 right-12 text-3xl">⭐</div>
                  </div>

                  {/* 메인 컨텐츠 */}
                  <div className="relative z-10 flex flex-col justify-between min-h-screen p-6 text-white">
                    
                    {/* 헤더 */}
                    <div className="text-center pt-8">
                      <div className="text-6xl mb-4">🥃</div>
                      <h1 className="text-2xl font-black mb-2">나만의 위스키 찾기</h1>
                      <p className="text-lg opacity-90">MBTI 스타일 취향 분석 완료!</p>
                    </div>

                    {/* 결과 카드 */}
                    <div className="bg-white/95 backdrop-blur-sm rounded-3xl p-8 mx-4 shadow-2xl">
                      <div className="text-center mb-6">
                        <div className="text-4xl mb-3">🏆</div>
                        <h2 className="text-2xl font-black text-gray-800 mb-2">당신의 위스키는</h2>
                        <h3 className="text-3xl font-black text-amber-600 mb-4">{topWhisky.name}</h3>
                        
                        {/* 매칭도 원형 게이지 */}
                        <div className="relative w-24 h-24 mx-auto mb-4">
                          <div className="w-24 h-24 rounded-full bg-gradient-to-r from-amber-400 to-orange-500 flex items-center justify-center">
                            <div className="w-20 h-20 rounded-full bg-white flex items-center justify-center">
                              <span className="text-xl font-black text-amber-600">{topWhisky.matchPercentage}%</span>
                            </div>
                          </div>
                        </div>
                      </div>

                      {/* 위스키 정보 */}
                      <div className="space-y-3 text-center">
                        <div className="flex items-center justify-center gap-2 text-gray-700">
                          <span className="text-xl">📍</span>
                          <span className="font-bold">{topWhisky.region}</span>
                        </div>
                        <div className="flex items-center justify-center gap-2 text-gray-700">
                          <span className="text-xl">⚡</span>
                          <span className="font-bold">도수 {topWhisky.abv}%</span>
                        </div>
                        <div className="flex items-center justify-center gap-2 text-gray-700">
                          <span className="text-xl">💰</span>
                          <span className="font-bold">{topWhisky.price}</span>
                        </div>
                      </div>

                      {/* 설명 */}
                      <div className="mt-6 p-4 bg-amber-50 rounded-2xl">
                        <p className="text-sm text-gray-700 font-medium text-center leading-relaxed">
                          {topWhisky.description}
                        </p>
                      </div>
                    </div>

                    {/* 하단 CTA */}
                    <div className="text-center pb-8 space-y-4">
                      <div className="mb-4">
                        <p className="text-lg font-bold mb-2">🎯 나도 테스트해보기</p>
                        <p className="text-sm opacity-90">whisky-recommendation.vercel.app</p>
                      </div>
                      
                      <button
                        onClick={shareToInstagram}
                        className="bg-white/20 backdrop-blur-sm border-2 border-white/50 text-white px-8 py-4 rounded-2xl font-bold text-lg hover:bg-white/30 transition-all w-full max-w-xs"
                      >
                        📱 인스타그램 공유하기
                      </button>
                      
                      <button
                        onClick={() => setShowDetailedResult(true)}
                        className="bg-white text-amber-600 px-6 py-3 rounded-xl font-bold hover:bg-gray-50 transition-all"
                      >
                        📋 상세 결과 보기
                      </button>
                      
                      <button
                        onClick={resetTest}
                        className="text-white/80 underline text-sm hover:text-white transition-colors block"
                      >
                        🔄 다시 테스트하기
                      </button>
                    </div>

                  </div>
                </div>
              );
            } else {
              // 상세 결과 화면 (기존 디자인 유지)
              return (
                <div className="max-w-4xl mx-auto p-6 bg-gradient-to-br from-amber-50 to-orange-50 min-h-screen">
                  <div className="bg-white rounded-2xl shadow-2xl p-8">
                    
                    {/* 뒤로 가기 버튼 */}
                    <button
                      onClick={() => setShowDetailedResult(false)}
                      className="flex items-center gap-2 text-amber-600 hover:text-amber-700 mb-6 font-medium"
                    >
                      <ChevronLeft />
                      스크린샷용 화면으로
                    </button>

                    <div className="text-center mb-8">
                      <h1 className="text-3xl font-bold text-amber-800 mb-2">🥃 당신만의 위스키 상세 결과</h1>
                      <p className="text-gray-600">취향 분석을 바탕으로 엄선한 추천 위스키들이에요</p>
                    </div>

                    <div className="space-y-6">
                      {result.map((whisky, index) => (
                        <div key={index} className="bg-gradient-to-r from-amber-100 to-orange-100 rounded-xl p-6 border-2 border-amber-200">
                          <div className="flex items-start justify-between mb-4">
                            <div className="flex items-center gap-3">
                              <div className="bg-amber-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold">
                                {index + 1}
                              </div>
                              <h3 className="text-xl font-bold text-amber-900">{whisky.name}</h3>
                              <div className="flex items-center gap-1">
                                <span className="text-sm text-gray-600">추천도:</span>
                                <div className="flex text-amber-500">
                                  {[...Array(Math.min(5, Math.max(1, Math.round((whisky.matchPercentage / 100) * 5))))].map((_, i) => (
                                    <Star key={i} />
                                  ))}
                                </div>
                              </div>
                            </div>
                            <div className="bg-amber-200 px-3 py-1 rounded-full text-sm font-medium text-amber-800">
                              매칭도: {whisky.matchPercentage}%
                            </div>
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div className="space-y-2">
                              <div className="flex items-center gap-2 text-sm text-gray-700">
                                <MapPin />
                                <span>{whisky.region}</span>
                              </div>
                              <div className="flex items-center gap-2 text-sm text-gray-700">
                                <Zap />
                                <span>도수: {whisky.abv}%</span>
                              </div>
                              <div className="flex items-center gap-2 text-sm text-gray-700">
                                <Grape />
                                <span>{whisky.price}</span>
                              </div>
                            </div>
                          </div>

                          <p className="text-gray-700 mb-2">{whisky.description}</p>
                          <p className="text-sm text-gray-600 bg-white p-3 rounded-lg">
                            <strong>테이스팅 노트:</strong> {whisky.notes}
                          </p>
                        </div>
                      ))}
                    </div>

                    <div className="mt-8 p-4 bg-amber-50 rounded-xl">
                      <h4 className="font-bold text-amber-800 mb-2">💡 초보자를 위한 팁</h4>
                      <ul className="text-sm text-gray-700 space-y-1">
                        <li>• 처음엔 스트레이트보다 온더락이나 하이볼로 시작해보세요</li>
                        <li>• 위스키 전용 글라스를 사용하면 향을 더 잘 느낄 수 있어요</li>
                        <li>• 물을 한두 방울 떨어뜨리면 향이 더 활짝 열립니다</li>
                        <li>• 천천히 음미하며 마시는 것이 포인트예요</li>
                      </ul>
                    </div>
                  </div>
                </div>
              );
            }
          }

          return null;
        };

        ReactDOM.render(<WhiskyRecommendationApp />, document.getElementById('root'));
    </script>
</body>
</html>