<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🥃 나만의 위스키 찾기 - MBTI 스타일 위스키 추천</title>
    <meta name="description" content="MBTI처럼 간단한 질문으로 당신의 취향에 딱 맞는 위스키를 추천해드려요. 3분이면 완료!">
    <meta name="keywords" content="위스키, 추천, MBTI, 취향, 테스트, 위스키 추천, 스카치, 버번, 일본위스키">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="🥃 나만의 위스키 찾기">
    <meta property="og:description" content="MBTI처럼 간단한 질문으로 취향에 맞는 위스키를 추천받으세요!">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://whisky-recommendation.vercel.app/">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="🥃 나만의 위스키 찾기">
    <meta name="twitter:description" content="MBTI처럼 간단한 질문으로 취향에 맞는 위스키를 추천받으세요!">
    
    <meta name="theme-color" content="#f59e0b">
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // 간단한 아이콘 컴포넌트들
        const ChevronRight = () => <span>→</span>;
        const ChevronLeft = () => <span>←</span>;
        const RotateCcw = () => <span>↻</span>;
        const Star = () => <span>⭐</span>;
        const MapPin = () => <span>📍</span>;
        const Zap = () => <span>⚡</span>;
        const Grape = () => <span>🍇</span>;

        const WhiskyRecommendationApp = () => {
          const [currentScreen, setCurrentScreen] = useState('landing');
          const [currentStep, setCurrentStep] = useState(0);
          const [answers, setAnswers] = useState({});
          const [result, setResult] = useState(null);

          const startTest = () => {
            setCurrentScreen('test');
          };

          const resetTest = () => {
            setCurrentStep(0);
            setAnswers({});
            setResult(null);
            setCurrentScreen('landing');
          };

          // 질문 데이터
          const questions = [
            {
              id: 'experience',
              title: '위스키 경험이 어느 정도인가요?',
              type: 'single',
              options: [
                { value: 'beginner', label: '완전 초보자 (위스키를 거의 안 마셔봤어요)', icon: '🌱' },
                { value: 'casual', label: '가끔 마셔봤어요 (하이볼 정도)', icon: '🍹' },
                { value: 'interested', label: '관심이 생겨서 알아보는 중이에요', icon: '🤔' },
                { value: 'experienced', label: '어느 정도 경험이 있어요', icon: '🥃' }
              ]
            },
            {
              id: 'whisky_type_preference',
              title: '어떤 종류의 위스키에 관심이 있으신가요?',
              type: 'multiple',
              subtitle: '생산지/제조방식별 선호도 (여러 개 선택 가능)',
              options: [
                { value: 'scotch_single', label: '스카치 싱글몰트 (한 증류소만, 깊고 개성적인 맛)', icon: '🏴󠁧󠁢󠁳󠁣󠁴󠁿' },
                { value: 'scotch_blend', label: '스카치 블렌디드 (여러 위스키 조합, 균형잡힌 맛)', icon: '🥃' },
                { value: 'american_bourbon', label: '아메리칸 버번 (달콤하고 바닐라향 강한)', icon: '🇺🇸' },
                { value: 'japanese', label: '일본 위스키 (섬세하고 우아한, 꽃향과 균형미)', icon: '🇯🇵' },
                { value: 'irish', label: '아이리시 위스키 (부드럽고 순한, 초보자 친화적)', icon: '🇮🇪' },
                { value: 'any', label: '상관없어요 (다양하게 경험해보고 싶어요)', icon: '🌍' }
              ]
            },
            {
              id: 'flavor_intensity',
              title: '위스키의 맛 강도는 어느 정도를 선호하시나요?',
              type: 'single',
              options: [
                { value: 'mild', label: '부드럽고 순한 맛 (처음 마시기 편한)', icon: '🕊️' },
                { value: 'moderate', label: '적당한 강도 (특징은 있지만 부담스럽지 않은)', icon: '⚖️' },
                { value: 'bold', label: '진하고 강한 맛 (개성이 뚜렷한)', icon: '⚡' },
                { value: 'complex', label: '복합적이고 깊은 맛 (다층적인 풍미)', icon: '🌊' }
              ]
            },
            {
              id: 'sweetness_preference',
              title: '단맛에 대한 선호도는?',
              type: 'single',
              options: [
                { value: 'very_sweet', label: '달콤한 맛을 정말 좋아해요 (꿀, 캐러멜, 바닐라)', icon: '🍯' },
                { value: 'moderate_sweet', label: '적당한 단맛이 좋아요 (과일, 초콜릿)', icon: '🍫' },
                { value: 'dry_sweet', label: '은은한 단맛 정도 (건과일, 견과류)', icon: '🥜' },
                { value: 'no_sweet', label: '단맛보다는 드라이한 맛을 선호해요', icon: '🌿' }
              ]
            },
            {
              id: 'fruit_preference',
              title: '과일향 중에서는 어떤 계열을 선호하시나요?',
              type: 'multiple',
              subtitle: '과일향에 대한 구체적인 선호도',
              options: [
                { value: 'citrus', label: '시트러스 (레몬, 오렌지, 자몽)', icon: '🍊' },
                { value: 'stone_fruit', label: '핵과류 (복숭아, 살구, 자두)', icon: '🍑' },
                { value: 'apple_pear', label: '사과/배 (신선하고 아삭한)', icon: '🍎' },
                { value: 'berry', label: '베리류 (딸기, 블루베리, 라즈베리)', icon: '🫐' },
                { value: 'tropical', label: '열대과일 (파인애플, 망고, 바나나)', icon: '🍍' },
                { value: 'dried_fruit', label: '건과일 (건포도, 무화과, 대추)', icon: '🥭' },
                { value: 'no_fruit', label: '과일향은 별로 선호하지 않아요', icon: '❌' }
              ]
            },
            {
              id: 'smoke_preference',
              title: '스모키한 맛(피트향)에 대해 어떻게 생각하세요?',
              type: 'single',
              subtitle: '아일레이 위스키의 특징인 연기/흙내음',
              options: [
                { value: 'avoid', label: '피하고 싶어요 (연기 냄새는 부담스러워요)', icon: '🚫' },
                { value: 'curious', label: '궁금해요 (한 번 도전해보고 싶어요)', icon: '🤨' },
                { value: 'light_smoke', label: '가벼운 스모키는 괜찮아요', icon: '💨' },
                { value: 'like', label: '스모키한 맛을 좋아해요', icon: '😍' },
                { value: 'love_peat', label: '진한 피트향을 매우 좋아해요', icon: '🔥' }
              ]
            },
            {
              id: 'alcohol_tolerance',
              title: '알코올 도수에 대한 선호도는?',
              type: 'single',
              options: [
                { value: 'low', label: '부드럽고 낮은 도수를 선호 (40도 이하)', icon: '😌' },
                { value: 'medium', label: '적당한 도수가 좋아요 (40-43도)', icon: '👌' },
                { value: 'high', label: '진한 맛을 원해요 (43도 이상)', icon: '💪' },
                { value: 'cask_strength', label: '원액 그대로의 강한 맛도 괜찮아요', icon: '🔥' }
              ]
            },
            {
              id: 'drinking_style',
              title: '어떤 방식으로 마시고 싶으신가요?',
              type: 'multiple',
              options: [
                { value: 'neat', label: '스트레이트 (그대로)', icon: '🥃' },
                { value: 'rocks', label: '온더락 (얼음과 함께)', icon: '🧊' },
                { value: 'highball', label: '하이볼 (탄산수와 함께)', icon: '🥤' },
                { value: 'cocktail', label: '칵테일 베이스로', icon: '🍸' },
                { value: 'water', label: '물을 조금 넣어서', icon: '💧' }
              ]
            },
            {
              id: 'atmosphere',
              title: '어떤 분위기에서 마시고 싶으신가요?',
              type: 'single',
              options: [
                { value: 'casual', label: '집에서 편안하게', icon: '🏠' },
                { value: 'social', label: '친구들과 함께', icon: '👥' },
                { value: 'special', label: '특별한 날에', icon: '🎉' },
                { value: 'contemplative', label: '혼자서 여유롭게', icon: '🤔' }
              ]
            },
            {
              id: 'budget',
              title: '예산대는 어느 정도인가요?',
              type: 'single',
              options: [
                { value: 'budget', label: '5만원 이하 (입문용)', icon: '💰' },
                { value: 'mid', label: '5-10만원 (중급)', icon: '💳' },
                { value: 'premium', label: '10-20만원 (프리미엄)', icon: '💎' },
                { value: 'luxury', label: '20만원 이상 (럭셔리)', icon: '👑' }
              ]
            }
          ];

          // 위스키 데이터베이스
          const whiskies = [
            {
              name: '글렌피딕 12년',
              region: '스코틀랜드 (스페이사이드)',
              type: 'scotch_single',
              abv: 40,
              price: '입문용 (5만원대)',
              intensity: 'mild',
              sweetness: 'moderate_sweet',
              fruits: ['apple_pear', 'citrus'],
              smoke: 'avoid',
              drinking_styles: ['neat', 'rocks', 'water'],
              description: '부드럽고 달콤한 과일향이 특징인 초보자 친화적인 위스키',
              notes: '배, 사과, 꿀, 바닐라의 조화로운 맛',
              suitable_for: ['beginner', 'casual'],
              atmosphere: ['casual', 'social']
            },
            {
              name: '맥켈란 12년',
              region: '스코틀랜드 (스페이사이드)',
              type: 'scotch_single',
              abv: 40,
              price: '중급 (8만원대)',
              intensity: 'moderate',
              sweetness: 'very_sweet',
              fruits: ['dried_fruit', 'citrus'],
              smoke: 'avoid',
              drinking_styles: ['neat', 'rocks'],
              description: '셰리 캐스크 숙성으로 풍부한 단맛과 견과류 향이 특징',
              notes: '건포도, 초콜릿, 생강, 오렌지껍질',
              suitable_for: ['casual', 'interested', 'experienced'],
              atmosphere: ['special', 'contemplative']
            },
            {
              name: '라가불린 16년',
              region: '스코틀랜드 (아일레이)',
              type: 'scotch_single',
              abv: 43,
              price: '프리미엄 (15만원대)',
              intensity: 'complex',
              sweetness: 'dry_sweet',
              fruits: ['dried_fruit'],
              smoke: 'love_peat',
              drinking_styles: ['neat', 'rocks', 'water'],
              description: '강렬한 피트향과 복합적인 맛의 균형이 뛰어난 아일레이 위스키',
              notes: '바다향, 연기, 말린 과일, 후추',
              suitable_for: ['interested', 'experienced'],
              atmosphere: ['contemplative', 'special']
            },
            {
              name: '조니워커 블랙라벨',
              region: '스코틀랜드',
              type: 'scotch_blend',
              abv: 40,
              price: '중급 (7만원대)',
              intensity: 'moderate',
              sweetness: 'moderate_sweet',
              fruits: ['stone_fruit', 'citrus'],
              smoke: 'light_smoke',
              drinking_styles: ['neat', 'rocks', 'highball', 'cocktail'],
              description: '균형잡힌 블렌딩으로 다양한 방식으로 즐길 수 있는 위스키',
              notes: '과일, 바닐라, 스파이스, 가벼운 스모키',
              suitable_for: ['casual', 'interested'],
              atmosphere: ['casual', 'social', 'special']
            },
            {
              name: '히비키 하모니',
              region: '일본',
              type: 'japanese',
              abv: 43,
              price: '프리미엄 (12만원대)',
              intensity: 'moderate',
              sweetness: 'moderate_sweet',
              fruits: ['citrus', 'stone_fruit'],
              smoke: 'avoid',
              drinking_styles: ['neat', 'rocks', 'highball'],
              description: '섬세하고 우아한 일본 위스키의 대표작',
              notes: '꽃향, 꿀, 오렌지, 백단향',
              suitable_for: ['interested', 'experienced'],
              atmosphere: ['special', 'contemplative']
            },
            {
              name: '에반 윌리엄스 블랙',
              region: '미국 (켄터키)',
              type: 'american_bourbon',
              abv: 43,
              price: '입문용 (4만원대)',
              intensity: 'moderate',
              sweetness: 'very_sweet',
              fruits: ['no_fruit'],
              smoke: 'avoid',
              drinking_styles: ['neat', 'rocks', 'cocktail'],
              description: '솔직하고 전형적인 버번의 특성을 가진 가성비 위스키',
              notes: '바닐라, 캐러멜, 브라운슈가, 오크',
              suitable_for: ['beginner', 'casual', 'interested'],
              atmosphere: ['casual', 'social']
            }
          ];

          const handleAnswer = (questionId, value) => {
            const question = questions[currentStep];
            if (question.type === 'multiple') {
              const currentAnswers = answers[questionId] || [];
              const newAnswers = currentAnswers.includes(value)
                ? currentAnswers.filter(v => v !== value)
                : [...currentAnswers, value];
              setAnswers({ ...answers, [questionId]: newAnswers });
            } else {
              setAnswers({ ...answers, [questionId]: value });
            }
          };

          const nextStep = () => {
            if (currentStep < questions.length - 1) {
              setCurrentStep(currentStep + 1);
            } else {
              calculateRecommendation();
            }
          };

          const prevStep = () => {
            if (currentStep > 0) {
              setCurrentStep(currentStep - 1);
            }
          };

          const calculateRecommendation = () => {
            let scores = whiskies.map(whisky => ({ ...whisky, score: 0 }));

            // 경험도 점수
            if (answers.experience) {
              scores.forEach(whisky => {
                if (whisky.suitable_for.includes(answers.experience)) {
                  whisky.score += 25;
                }
              });
            }

            // 위스키 타입 선호도 점수
            if (answers.whisky_type_preference) {
              scores.forEach(whisky => {
                if (answers.whisky_type_preference.includes('any') || 
                    answers.whisky_type_preference.includes(whisky.type)) {
                  whisky.score += 20;
                }
              });
            }

            // 맛 강도 선호도 점수
            if (answers.flavor_intensity) {
              scores.forEach(whisky => {
                if (whisky.intensity === answers.flavor_intensity) {
                  whisky.score += 20;
                }
              });
            }

            // 단맛 선호도 점수
            if (answers.sweetness_preference) {
              scores.forEach(whisky => {
                if (whisky.sweetness === answers.sweetness_preference) {
                  whisky.score += 20;
                }
              });
            }

            // 과일향 선호도 점수
            if (answers.fruit_preference) {
              scores.forEach(whisky => {
                if (answers.fruit_preference.includes('no_fruit')) {
                  if (whisky.fruits.includes('no_fruit')) {
                    whisky.score += 15;
                  }
                } else {
                  const matchingFruits = whisky.fruits.filter(fruit => 
                    answers.fruit_preference.includes(fruit)
                  ).length;
                  whisky.score += matchingFruits * 10;
                }
              });
            }

            // 스모키 선호도 점수
            if (answers.smoke_preference) {
              scores.forEach(whisky => {
                if (whisky.smoke === answers.smoke_preference) {
                  whisky.score += 25;
                }
                if (answers.smoke_preference === 'curious' && whisky.smoke === 'light_smoke') {
                  whisky.score += 15;
                }
              });
            }

            // 도수 선호도 점수
            if (answers.alcohol_tolerance) {
              scores.forEach(whisky => {
                if (answers.alcohol_tolerance === 'low' && whisky.abv <= 40) whisky.score += 15;
                if (answers.alcohol_tolerance === 'medium' && whisky.abv >= 40 && whisky.abv <= 43) whisky.score += 15;
                if (answers.alcohol_tolerance === 'high' && whisky.abv > 43) whisky.score += 15;
              });
            }

            // 마시는 방식 점수
            if (answers.drinking_style) {
              scores.forEach(whisky => {
                const matchingStyles = whisky.drinking_styles.filter(style => 
                  answers.drinking_style.includes(style)
                ).length;
                whisky.score += matchingStyles * 10;
              });
            }

            // 분위기 점수
            if (answers.atmosphere) {
              scores.forEach(whisky => {
                if (whisky.atmosphere.includes(answers.atmosphere)) {
                  whisky.score += 15;
                }
              });
            }

            // 예산 점수
            if (answers.budget) {
              scores.forEach(whisky => {
                if (answers.budget === 'budget' && whisky.price.includes('입문용')) whisky.score += 20;
                if (answers.budget === 'mid' && (whisky.price.includes('중급') || whisky.price.includes('입문용'))) whisky.score += 20;
                if (answers.budget === 'premium' && whisky.price.includes('프리미엄')) whisky.score += 20;
              });
            }

            // 점수순으로 정렬하여 상위 3개 추천
            const recommendations = scores
              .sort((a, b) => b.score - a.score)
              .slice(0, 3);

            // 매칭도 계산
            if (recommendations.length > 0) {
              const maxPossibleScore = 180;
              recommendations.forEach(whisky => {
                const rawPercentage = (whisky.score / maxPossibleScore) * 100;
                whisky.matchPercentage = Math.min(98, Math.max(65, Math.round(rawPercentage)));
              });
            }

            setResult(recommendations);
            setCurrentScreen('result');
          };

          const shareResult = () => {
            const topWhisky = result[0];
            const shareText = `🥃 나만의 위스키 찾기 결과!\n\n추천 위스키: ${topWhisky.name}\n매칭도: ${topWhisky.matchPercentage}%\n\n${topWhisky.description}\n\n당신의 취향은? 테스트해보세요!`;
            const shareUrl = window.location.href;

            if (navigator.share) {
              navigator.share({
                title: '🥃 나만의 위스키 찾기 결과',
                text: shareText,
                url: shareUrl
              }).catch(console.error);
            } else {
              const fullText = `${shareText}\n\n${shareUrl}`;
              navigator.clipboard.writeText(fullText).then(() => {
                alert('🎉 공유 텍스트가 클립보드에 복사되었습니다!\nSNS에 붙여넣기 해주세요.');
              }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = fullText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('🎉 공유 텍스트가 복사되었습니다!\nSNS에 붙여넣기 해주세요.');
              });
            }
          };

          const generateResultImage = () => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // 캔버스 크기 설정 (인스타그램 스토리 비율: 9:16)
            canvas.width = 1080;
            canvas.height = 1920;
            
            const topWhisky = result[0];
            
            // 배경 그라데이션
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#FEF3C7'); // amber-100
            gradient.addColorStop(1, '#FED7AA'); // orange-200
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 메인 배경 카드
            ctx.fillStyle = '#FFFFFF';
            ctx.roundRect = function(x, y, w, h, r) {
              this.beginPath();
              this.moveTo(x + r, y);
              this.lineTo(x + w - r, y);
              this.quadraticCurveTo(x + w, y, x + w, y + r);
              this.lineTo(x + w, y + h - r);
              this.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
              this.lineTo(x + r, y + h);
              this.quadraticCurveTo(x, y + h, x, y + h - r);
              this.lineTo(x, y + r);
              this.quadraticCurveTo(x, y, x + r, y);
              this.closePath();
            };
            
            ctx.roundRect(80, 200, 920, 1500, 40);
            ctx.fill();
            
            // 그림자 효과
            ctx.shadowColor = 'rgba(0, 0, 0, 0.1)';
            ctx.shadowBlur = 20;
            ctx.shadowOffsetY = 10;
            
            // 텍스트 설정
            ctx.shadowColor = 'transparent';
            ctx.fillStyle = '#92400E'; // amber-800
            ctx.textAlign = 'center';
            
            // 제목
            ctx.font = 'bold 80px Arial';
            ctx.fillText('🥃', 540, 350);
            
            ctx.font = 'bold 64px Arial';
            ctx.fillText('나만의 위스키 찾기', 540, 450);
            
            // 결과 제목
            ctx.font = 'bold 48px Arial';
            ctx.fillStyle = '#D97706'; // amber-600
            ctx.fillText('추천 결과', 540, 580);
            
            // 1위 뱃지
            ctx.fillStyle = '#F59E0B'; // amber-500
            ctx.beginPath();
            ctx.arc(200, 720, 40, 0, 2 * Math.PI);
            ctx.fill();
            
            ctx.fillStyle = '#FFFFFF';
            ctx.font = 'bold 36px Arial';
            ctx.fillText('1', 200, 735);
            
            // 위스키 이름
            ctx.fillStyle = '#92400E'; // amber-800
            ctx.font = 'bold 56px Arial';
            ctx.textAlign = 'left';
            const whiskyName = topWhisky.name;
            ctx.fillText(whiskyName, 280, 735);
            
            // 매칭도
            ctx.fillStyle = '#F59E0B'; // amber-500
            ctx.font = 'bold 42px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`매칭도: ${topWhisky.matchPercentage}%`, 540, 820);
            
            // 별점 표시
            const starCount = Math.round((topWhisky.matchPercentage / 100) * 5);
            let starText = '';
            for (let i = 0; i < starCount; i++) {
              starText += '⭐';
            }
            ctx.font = '48px Arial';
            ctx.fillText(starText, 540, 900);
            
            // 지역 정보
            ctx.fillStyle = '#6B7280'; // gray-500
            ctx.font = '36px Arial';
            ctx.fillText(`📍 ${topWhisky.region}`, 540, 980);
            
            // 도수 정보
            ctx.fillText(`⚡ 도수: ${topWhisky.abv}%`, 540, 1040);
            
            // 가격 정보
            ctx.fillText(`💰 ${topWhisky.price}`, 540, 1100);
            
            // 설명
            ctx.fillStyle = '#374151'; // gray-700
            ctx.font = '32px Arial';
            ctx.textAlign = 'center';
            
            // 텍스트 줄바꿈 처리
            const description = topWhisky.description;
            const maxWidth = 800;
            const words = description.split(' ');
            let line = '';
            let y = 1200;
            
            for (let n = 0; n < words.length; n++) {
              const testLine = line + words[n] + ' ';
              const metrics = ctx.measureText(testLine);
              const testWidth = metrics.width;
              
              if (testWidth > maxWidth && n > 0) {
                ctx.fillText(line, 540, y);
                line = words[n] + ' ';
                y += 50;
              } else {
                line = testLine;
              }
            }
            ctx.fillText(line, 540, y);
            
            // 테이스팅 노트
            ctx.fillStyle = '#D97706'; // amber-600
            ctx.font = 'bold 36px Arial';
            ctx.fillText('테이스팅 노트', 540, y + 120);
            
            ctx.fillStyle = '#6B7280'; // gray-500
            ctx.font = '30px Arial';
            const notes = topWhisky.notes;
            const noteWords = notes.split(' ');
            let noteLine = '';
            let noteY = y + 180;
            
            for (let n = 0; n < noteWords.length; n++) {
              const testLine = noteLine + noteWords[n] + ' ';
              const metrics = ctx.measureText(testLine);
              const testWidth = metrics.width;
              
              if (testWidth > maxWidth && n > 0) {
                ctx.fillText(noteLine, 540, noteY);
                noteLine = noteWords[n] + ' ';
                noteY += 45;
              } else {
                noteLine = testLine;
              }
            }
            ctx.fillText(noteLine, 540, noteY);
            
            // 하단 CTA
            ctx.fillStyle = '#F59E0B'; // amber-500
            ctx.font = 'bold 42px Arial';
            ctx.fillText('당신의 취향은?', 540, 1550);
            
            ctx.fillStyle = '#92400E'; // amber-800
            ctx.font = 'bold 38px Arial';
            ctx.fillText('나만의 위스키 찾기 테스트', 540, 1610);
            
            // URL에 이미지와 링크 정보 추가
            ctx.fillStyle = '#6B7280'; // gray-500
            ctx.font = '28px Arial';
            ctx.fillText('whisky-recommendation.vercel.app', 540, 1670);
            
            // QR 코드나 링크 유도 문구
            ctx.fillStyle = '#F59E0B'; // amber-500
            ctx.font = 'bold 32px Arial';
            ctx.fillText('🔗 링크를 통해 테스트해보세요!', 540, 1720);
            
            return canvas;
          };

          const downloadResultImage = () => {
            try {
              const canvas = generateResultImage();
              
              // 이미지 다운로드
              canvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.download = `위스키추천결과_${result[0].name.replace(/\s+/g, '_')}.png`;
                link.href = url;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                // 다운로드 완료 알림
                alert('📸 이미지가 다운로드되었습니다!\n갤러리에서 확인 후 인스타그램에 업로드해주세요.');
              }, 'image/png');
            } catch (error) {
              console.error('이미지 생성 실패:', error);
              alert('❌ 이미지 생성에 실패했습니다. 다시 시도해주세요.');
            }
          };

          const shareToInstagram = async () => {
            try {
              const topWhisky = result[0];
              const shareUrl = window.location.href;
              const shareText = `🥃 나만의 위스키 찾기!\n\n추천: ${topWhisky.name}\n매칭도: ${topWhisky.matchPercentage}%`;
              
              // Web Share API가 지원되는 경우 (주로 모바일)
              if (navigator.share && navigator.canShare) {
                const canvas = generateResultImage();
                
                // Canvas를 Blob으로 변환
                canvas.toBlob(async (blob) => {
                  const file = new File([blob], `위스키추천_${topWhisky.name}.png`, { type: 'image/png' });
                  
                  const shareData = {
                    title: '🥃 나만의 위스키 찾기 결과',
                    text: shareText,
                    url: shareUrl,
                    files: [file]
                  };
                  
                  // Web Share API로 파일 공유 가능한지 확인
                  if (navigator.canShare(shareData)) {
                    try {
                      await navigator.share(shareData);
                      console.log('인스타그램 공유 성공');
                    } catch (error) {
                      console.log('사용자가 공유를 취소했습니다.');
                      // 취소한 경우 기본 다운로드 방식으로 fallback
                      fallbackInstagramShare();
                    }
                  } else {
                    // 파일 공유가 지원되지 않는 경우
                    fallbackInstagramShare();
                  }
                }, 'image/png');
              } else {
                // Web Share API가 지원되지 않는 경우
                fallbackInstagramShare();
              }
            } catch (error) {
              console.error('인스타그램 공유 오류:', error);
              fallbackInstagramShare();
            }
          };

          const fallbackInstagramShare = () => {
            // 기존 방식: 이미지 다운로드 후 수동 업로드
            const canvas = generateResultImage();
            const topWhisky = result[0];
            
            canvas.toBlob((blob) => {
              // 이미지 다운로드
              const url = URL.createObjectURL(blob);
              const link = document.createElement('a');
              link.download = `위스키추천_${topWhisky.name.replace(/\s+/g, '_')}.png`;
              link.href = url;
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);
              URL.revokeObjectURL(url);
              
              // 인스타그램 앱/웹 열기
              setTimeout(() => {
                if (/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                  // 모바일: 인스타그램 스토리 직접 열기
                  const instagramStoryUrl = 'instagram://story-camera';
                  window.location.href = instagramStoryUrl;
                  
                  setTimeout(() => {
                    // 앱이 설치되지 않은 경우 웹으로
                    window.open('https://www.instagram.com/stories/create/', '_blank');
                  }, 2000);
                } else {
                  // PC: 인스타그램 웹의 스토리 생성 페이지
                  window.open('https://www.instagram.com/stories/create/', '_blank');
                }
                
                alert('📸 이미지가 다운로드되었습니다!\n인스타그램 스토리에서 갤러리에서 선택하여 업로드해주세요.');
              }, 500);
            }, 'image/png');
          };

          // 새로운 고급 인스타그램 공유 함수 (URL Scheme 활용)
          const shareToInstagramAdvanced = () => {
            const topWhisky = result[0];
            const shareUrl = encodeURIComponent(window.location.href);
            const shareText = encodeURIComponent(`🥃 나만의 위스키 찾기!\n\n추천: ${topWhisky.name}\n매칭도: ${topWhisky.matchPercentage}%\n\n테스트해보세요!`);
            
            if (/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
              // 모바일에서 이미지를 Base64로 변환하여 전달
              const canvas = generateResultImage();
              canvas.toBlob((blob) => {
                const reader = new FileReader();
                reader.onload = function() {
                  const base64Data = reader.result.split(',')[1];
                  
                  // Instagram Stories URL Scheme (iOS/Android)
                  const instagramUrl = `instagram://story-camera?media=${encodeURIComponent(base64Data)}&text=${shareText}&url=${shareUrl}`;
                  
                  try {
                    window.location.href = instagramUrl;
                    
                    // 3초 후 앱이 열리지 않으면 기본 방식으로
                    setTimeout(() => {
                      fallbackInstagramShare();
                    }, 3000);
                  } catch (error) {
                    fallbackInstagramShare();
                  }
                };
                reader.readAsDataURL(blob);
              }, 'image/png');
            } else {
              // PC에서는 기본 방식 사용
              fallbackInstagramShare();
            }
          };

          const shareToKakao = () => {
            const topWhisky = result[0];
            const shareText = `🥃 나만의 위스키 찾기!\n\n내 추천: ${topWhisky.name}\n매칭도: ${topWhisky.matchPercentage}%\n\n${topWhisky.description}\n\n당신도 테스트해보세요: ${window.location.href}`;
            
            if (/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
              // 모바일: 텍스트 복사 후 카카오톡 앱 열기
              navigator.clipboard.writeText(shareText).then(() => {
                // 카카오톡 앱 열기
                const kakaoUrl = 'kakaotalk://';
                const fallbackUrl = 'https://web.kakao.com/';
                
                window.location.href = kakaoUrl;
                
                // 3초 후에도 페이지가 그대로면 웹으로
                setTimeout(() => {
                  window.open(fallbackUrl, '_blank');
                }, 3000);
                
                alert('💬 텍스트가 복사되었습니다!\n카카오톡에서 친구에게 보내주세요.');
              }).catch(() => {
                // 클립보드 실패시 수동 복사
                const textArea = document.createElement('textarea');
                textArea.value = shareText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                window.location.href = 'kakaotalk://';
                alert('💬 텍스트가 복사되었습니다!\n카카오톡에서 친구에게 보내주세요.');
              });
            } else {
              // PC: 텍스트 복사 후 카카오톡 웹 열기
              navigator.clipboard.writeText(shareText).then(() => {
                window.open('https://web.kakao.com/', '_blank');
                alert('💬 텍스트가 복사되었습니다!\n카카오톡에서 친구에게 보내주세요.');
              }).catch(() => {
                window.open('https://web.kakao.com/', '_blank');
                alert('💬 카카오톡 웹에서 친구에게 결과를 공유해주세요!');
              });
            }
          };

          // 랜딩 페이지
          if (currentScreen === 'landing') {
            return (
              <div className="max-w-2xl mx-auto p-4 bg-gradient-to-br from-amber-50 to-orange-50 min-h-screen flex items-center">
                <div className="bg-white rounded-2xl shadow-2xl p-6 w-full">
                  <div className="text-center mb-8">
                    <div className="text-5xl mb-3">🥃</div>
                    <h1 className="text-3xl font-bold text-amber-800 mb-3">
                      나만의 위스키 찾기
                    </h1>
                    <p className="text-gray-600 mb-4">
                      MBTI처럼 간단한 질문으로<br/>
                      취향에 딱 맞는 위스키를 추천해드려요
                    </p>
                  </div>

                  <div className="grid grid-cols-3 gap-3 mb-8">
                    <div className="text-center p-3 bg-amber-50 rounded-lg">
                      <div className="text-2xl mb-1">🎯</div>
                      <p className="text-xs font-medium text-amber-800">정확한<br/>추천</p>
                    </div>
                    <div className="text-center p-3 bg-orange-50 rounded-lg">
                      <div className="text-2xl mb-1">⚡</div>
                      <p className="text-xs font-medium text-orange-800">3분<br/>완료</p>
                    </div>
                    <div className="text-center p-3 bg-yellow-50 rounded-lg">
                      <div className="text-2xl mb-1">🏆</div>
                      <p className="text-xs font-medium text-yellow-800">전문<br/>큐레이션</p>
                    </div>
                  </div>

                  <div className="mb-8 p-4 bg-gradient-to-r from-amber-100 to-orange-100 rounded-xl">
                    <h3 className="text-center font-bold text-amber-800 mb-3">
                      📊 이런 식으로 추천해요!
                    </h3>
                    <div className="bg-white p-3 rounded-lg">
                      <div className="flex items-center gap-2 mb-2">
                        <div className="bg-amber-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">1</div>
                        <span className="font-bold text-amber-900 text-sm">글렌피딕 12년</span>
                        <span className="bg-amber-200 px-2 py-1 rounded-full text-xs text-amber-800 font-medium ml-auto">95%</span>
                      </div>
                      <div className="flex gap-1 mb-2">
                        <span className="bg-green-100 px-2 py-1 rounded-full text-xs text-green-700">✨ 논스모키</span>
                        <span className="bg-blue-50 px-2 py-1 rounded-full text-xs text-blue-700">🍎 과일향</span>
                      </div>
                      <p className="text-xs text-gray-600">부드럽고 달콤한 초보자 친화적인 위스키</p>
                    </div>
                  </div>

                  <div className="text-center">
                    <button
                      onClick={startTest}
                      className="w-full bg-gradient-to-r from-amber-500 to-orange-500 text-white py-4 rounded-2xl text-lg font-bold hover:from-amber-600 hover:to-orange-600 transition-all duration-300 shadow-lg"
                    >
                      🚀 테스트 시작하기
                    </button>
                    <p className="text-xs text-gray-500 mt-3">
                      3분 소요 • 무료 • 회원가입 불필요
                    </p>
                  </div>
                </div>
              </div>
            );
          }

          const currentQuestion = questions[currentStep];
          const canProceed = answers[currentQuestion?.id] && 
            (currentQuestion?.type !== 'multiple' || answers[currentQuestion?.id].length > 0);

          if (result) {
            return (
              <div className="max-w-4xl mx-auto p-6 bg-gradient-to-br from-amber-50 to-orange-50 min-h-screen">
                <div className="bg-white rounded-2xl shadow-2xl p-8">
                  <div className="text-center mb-8">
                    <h1 className="text-3xl font-bold text-amber-800 mb-2">🥃 당신만의 위스키를 찾았습니다!</h1>
                    <p className="text-gray-600">취향 분석을 바탕으로 엄선한 추천 위스키들이에요</p>
                  </div>

                  <div className="space-y-6">
                    {result.map((whisky, index) => (
                      <div key={index} className="bg-gradient-to-r from-amber-100 to-orange-100 rounded-xl p-6 border-2 border-amber-200">
                        <div className="flex items-start justify-between mb-4">
                          <div className="flex items-center gap-3">
                            <div className="bg-amber-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold">
                              {index + 1}
                            </div>
                            <h3 className="text-xl font-bold text-amber-900">{whisky.name}</h3>
                            <div className="flex items-center gap-1">
                              <span className="text-sm text-gray-600">추천도:</span>
                              <div className="flex text-amber-500">
                                {[...Array(Math.min(5, Math.max(1, Math.round((whisky.matchPercentage / 100) * 5))))].map((_, i) => (
                                  <Star key={i} />
                                ))}
                              </div>
                            </div>
                          </div>
                          <div className="bg-amber-200 px-3 py-1 rounded-full text-sm font-medium text-amber-800">
                            매칭도: {whisky.matchPercentage}%
                          </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                          <div className="space-y-2">
                            <div className="flex items-center gap-2 text-sm text-gray-700">
                              <MapPin />
                              <span>{whisky.region}</span>
                            </div>
                            <div className="flex items-center gap-2 text-sm text-gray-700">
                              <Zap />
                              <span>도수: {whisky.abv}%</span>
                            </div>
                            <div className="flex items-center gap-2 text-sm text-gray-700">
                              <Grape />
                              <span>{whisky.price}</span>
                            </div>
                          </div>
                          <div className="space-y-2">
                            <div className="flex flex-wrap gap-1">
                              <span className="bg-white px-2 py-1 rounded-full text-xs text-amber-700 border border-amber-300">
                                {whisky.intensity === 'mild' && '부드러운'}
                                {whisky.intensity === 'moderate' && '적당한'}
                                {whisky.intensity === 'bold' && '진한'}
                                {whisky.intensity === 'complex' && '복합적인'}
                              </span>
                              <span className="bg-white px-2 py-1 rounded-full text-xs text-amber-700 border border-amber-300">
                                {whisky.sweetness === 'very_sweet' && '달콤함'}
                                {whisky.sweetness === 'moderate_sweet' && '적당한 단맛'}
                                {whisky.sweetness === 'dry_sweet' && '은은한 단맛'}
                                {whisky.sweetness === 'no_sweet' && '드라이함'}
                              </span>
                              
                              {/* 피트향/스모키 강도 */}
                              {whisky.smoke === 'love_peat' && (
                                <span className="bg-red-100 px-2 py-1 rounded-full text-xs text-red-700 border border-red-300 font-medium">🔥 진한 피트향</span>
                              )}
                              {whisky.smoke === 'like' && (
                                <span className="bg-orange-100 px-2 py-1 rounded-full text-xs text-orange-700 border border-orange-300 font-medium">💨 스모키</span>
                              )}
                              {whisky.smoke === 'light_smoke' && (
                                <span className="bg-yellow-100 px-2 py-1 rounded-full text-xs text-yellow-700 border border-yellow-300 font-medium">☁️ 가벼운 스모키</span>
                              )}
                              {whisky.smoke === 'avoid' && (
                                <span className="bg-green-100 px-2 py-1 rounded-full text-xs text-green-700 border border-green-300 font-medium">✨ 논스모키</span>
                              )}
                              
                              {/* 과일향 */}
                              {whisky.fruits.includes('citrus') && (
                                <span className="bg-white px-2 py-1 rounded-full text-xs text-amber-700 border border-amber-300">🍊 시트러스</span>
                              )}
                              {whisky.fruits.includes('stone_fruit') && (
                                <span className="bg-white px-2 py-1 rounded-full text-xs text-amber-700 border border-amber-300">🍑 핵과류</span>
                              )}
                              {whisky.fruits.includes('apple_pear') && (
                                <span className="bg-white px-2 py-1 rounded-full text-xs text-amber-700 border border-amber-300">🍎 사과/배</span>
                              )}
                              {whisky.fruits.includes('dried_fruit') && (
                                <span className="bg-white px-2 py-1 rounded-full text-xs text-amber-700 border border-amber-300">🥭 건과일</span>
                              )}
                              {whisky.fruits.includes('tropical') && (
                                <span className="bg-white px-2 py-1 rounded-full text-xs text-amber-700 border border-amber-300">🍍 열대과일</span>
                              )}
                            </div>
                          </div>
                        </div>

                        <p className="text-gray-700 mb-2">{whisky.description}</p>
                        <p className="text-sm text-gray-600 bg-white p-3 rounded-lg">
                          <strong>테이스팅 노트:</strong> {whisky.notes}
                        </p>
                      </div>
                    ))}
                  </div>

                  <div className="mt-8 text-center space-y-4">
                    {/* 공유 버튼들 */}
                    <div className="mb-6">
                      <h4 className="text-lg font-bold text-gray-800 mb-4">📢 결과 공유하기</h4>
                      <div className="flex flex-wrap justify-center gap-3">
                        <button
                          onClick={shareResult}
                          className="flex items-center gap-2 bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors text-sm font-medium"
                        >
                          📤 공유하기
                        </button>
                        <button
                          onClick={shareToInstagram}
                          className="flex items-center gap-2 bg-gradient-to-r from-pink-500 to-purple-500 text-white px-4 py-2 rounded-lg hover:from-pink-600 hover:to-purple-600 transition-colors text-sm font-medium"
                        >
                          📸 인스타그램 스토리
                        </button>
                        <button
                          onClick={shareToInstagramAdvanced}
                          className="flex items-center gap-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-4 py-2 rounded-lg hover:from-purple-700 hover:to-indigo-700 transition-colors text-sm font-medium"
                        >
                          ✨ 인스타그램 직접공유
                        </button>
                        <button
                          onClick={shareToKakao}
                          className="flex items-center gap-2 bg-yellow-400 text-gray-800 px-4 py-2 rounded-lg hover:bg-yellow-500 transition-colors text-sm font-medium"
                        >
                          💬 카카오톡
                        </button>
                      </div>
                    </div>

                    {/* 다시 테스트 버튼 */}
                    <button
                      onClick={resetTest}
                      className="inline-flex items-center gap-2 bg-amber-600 text-white px-6 py-3 rounded-xl hover:bg-amber-700 transition-colors font-medium"
                    >
                      <RotateCcw />
                      처음으로 돌아가기
                    </button>
                  </div>

                  <div className="mt-8 p-4 bg-amber-50 rounded-xl">
                    <h4 className="font-bold text-amber-800 mb-2">💡 초보자를 위한 팁</h4>
                    <ul className="text-sm text-gray-700 space-y-1">
                      <li>• 처음엔 스트레이트보다 온더락이나 하이볼로 시작해보세요</li>
                      <li>• 위스키 전용 글라스를 사용하면 향을 더 잘 느낄 수 있어요</li>
                      <li>• 물을 한두 방울 떨어뜨리면 향이 더 활짝 열립니다</li>
                      <li>• 천천히 음미하며 마시는 것이 포인트예요</li>
                    </ul>
                  </div>
                </div>
              </div>
            );
          }

          // 테스트 화면
          return (
            <div className="max-w-2xl mx-auto p-6 bg-gradient-to-br from-amber-50 to-orange-50 min-h-screen">
              <div className="bg-white rounded-2xl shadow-2xl p-8">
                {/* 헤더 */}
                <div className="text-center mb-8">
                  <h1 className="text-3xl font-bold text-amber-800 mb-2">🥃 나만의 위스키 찾기</h1>
                  <p className="text-gray-600">MBTI처럼 간단한 질문으로 취향에 맞는 위스키를 추천해드려요</p>
                </div>

                {/* 진행도 */}
                <div className="mb-8">
                  <div className="flex justify-between text-sm text-gray-500 mb-2">
                    <span>진행도</span>
                    <span>{currentStep + 1} / {questions.length}</span>
                  </div>
                  <div className="w-full bg-gray-200 rounded-full h-2">
                    <div 
                      className="bg-gradient-to-r from-amber-400 to-orange-500 h-2 rounded-full transition-all duration-500"
                      style={{ width: `${((currentStep + 1) / questions.length) * 100}%` }}
                    />
                  </div>
                </div>

                {/* 질문 */}
                <div className="mb-8">
                  <h2 className="text-xl font-bold text-gray-800 mb-2">{currentQuestion.title}</h2>
                  {currentQuestion.subtitle && (
                    <p className="text-sm text-gray-600 mb-4">{currentQuestion.subtitle}</p>
                  )}

                  <div className="space-y-3">
                    {currentQuestion.options.map((option) => {
                      return (
                        <button
                          key={option.value}
                          onClick={() => handleAnswer(currentQuestion.id, option.value)}
                          className={`w-full p-4 rounded-xl border-2 text-left transition-all duration-200 ${
                            isSelected
                              ? 'border-amber-500 bg-amber-50 text-amber-900'
                              : 'border-gray-200 hover:border-amber-300 hover:bg-amber-25'
                          }`}
                        >
                          <div className="flex items-center gap-3">
                            <span className="text-2xl">{option.icon}</span>
                            <span className="font-medium">{option.label}</span>
                          </div>
                        </button>
                      );
                    })}
                  </div>
                </div>

                {/* 네비게이션 */}
                <div className="flex justify-between">
                  <button
                    onClick={prevStep}
                    disabled={currentStep === 0}
                    className={`inline-flex items-center gap-2 px-6 py-3 rounded-xl transition-colors ${
                      currentStep === 0
                        ? 'bg-gray-100 text-gray-400 cursor-not-allowed'
                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                    }`}
                  >
                    <ChevronLeft />
                    이전
                  </button>

                  <button
                    onClick={nextStep}
                    disabled={!canProceed}
                    className={`inline-flex items-center gap-2 px-6 py-3 rounded-xl transition-colors font-medium ${
                      canProceed
                        ? 'bg-amber-600 text-white hover:bg-amber-700'
                        : 'bg-gray-100 text-gray-400 cursor-not-allowed'
                    }`}
                  >
                    {currentStep === questions.length - 1 ? '결과 보기' : '다음'}
                    <ChevronRight />
                  </button>
                </div>
              </div>
            </div>
          );
        };

        ReactDOM.render(<WhiskyRecommendationApp />, document.getElementById('root'));
    </script>
</body>
</html>